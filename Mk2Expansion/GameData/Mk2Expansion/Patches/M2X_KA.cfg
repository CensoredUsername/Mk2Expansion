// Kerbal Atomics Patch

// adapted from KerbalAtomics, changing the part into a dual mode
// LF / LH2 engine, with appropriate balancing.
@PART[M2X_Pluto]:NEEDS[KerbalAtomics,!KSPIntegration,!NTRsUseLF]
{
	// kerbalAtomics LV-N is 21% lighter
	@mass -= 0.96

	MODULE
	{
		name = MultiModeEngine
		primaryEngineID = LF
		secondaryEngineID = LH2
    	primaryEngineModeDisplayName = #LOC_KerbalAtomics_Multimode_LF
    	secondaryEngineModeDisplayName = #LOC_KerbalAtomics_Multimode_LH2
	}

	// this should be used in both modes
	@MODULE[ModuleAlternator]
	{
		preferMultiMode = true
	}

	// this should be used in both modes
	@MODULE[FXModuleAnimateThrottle]
	{
		preferMultiMode = true
	}

	// reduce the LF performance to match the LV-N under kerbal atomics
	@MODULE[ModuleEnginesFX]
	{
		!atmosphereCurve {}
		atmosphereCurve
		{
			key = 0 600
			key = 1 185
			key = 2 0.001
		}
	}

	// and add a LH2 mode to match the LV-N under kerbal atomics
	// by copying the LF one
	$MODULE[ModuleEnginesFX]:HAS[#engineID[LF]]
	{
		@engineID = LH2
		@runningEffectName = mode_LH2

		@PROPELLANT[LiquidFuel] 
		{
			@name = LqdHydrogen
			@ratio = 1.0
		}

		!atmosphereCurve {}
		atmosphereCurve
		{
			key = 0 900
			key = 1 400
			key = 2 50
			key = 10 1
		}
	}

	@EFFECTS
	{
		// this is just a copy of the mode_LF
		mode_LH2
		{
			AUDIO
			{
				channel = Ship
				clip = sound_rocket_hard
				volume = 0.0 0.0
				volume = 1.0 1.0
				pitch = 0.0 0.2
				pitch = 1.0 1.0
				loop = true
			}
			PREFAB_PARTICLE
			{
				prefabName = fx_smokeTrail_light
				transformName = thrustTransform
				emission = 0.0 0.0
				emission = 0.05 0.0
				emission = 0.075 0.25
				emission = 1.0 1.25
				speed = 0.0 0.25
				speed = 1.0 1.0
				localOffset = 0, 0, 1
				localRotation = 1, 0, 0, -90
			}
			MODEL_MULTI_PARTICLE
			{
				modelName = Mk2Expansion/FX/Pluto_Plume
				transformName = thrustTransform
				emission = 0.0 0.0
				emission = 0.05 0.0
				emission = 0.075 0.25
				emission = 1.0 1.25
				speed = 0.0 0.5
				speed = 0.2 0.8
			}
		}
	}
}
